---
title: "radial diagram"
output: html_document
date: "2025-07-18"
---

```{r}
library(ggplot2)
library(readxl)
library(tidyr)
library(dplyr)
```

```{r}
data <- read_xlsx("FINAL Sleep Content Coding (1).xlsx", sheet = 3)
```

```{r}
#big_to_small <- data[, c("Symptom.Broad.Category", "Symptom", "SSR", "SDSC", "CSHQ", "CRSP", "PSQ", "PSQI", "CBCL", "BASC-3-PR", "PGBI", "CASI")]

small_to_big <- data[, c("Symptom Broad Category", "Symptom", "SSR", "SDSC", "CSHQ", "CRSP", "PSQ", "PSQI")]

small_to_big <- small_to_big %>%
  rename(., broad.symptoms = `Symptom Broad Category`)
```

```{r}
# long_data <- data %>%
#   pivot_longer(cols = c("PANSS.10", "PANSS.30", "SAPS", "CRSS", "BPRS.18", "BPRS.24", "PSYRATS", "SANS", "CAINS", "BNSS", "MPS_SR", "NSA.16", "NSA.4"),
#                names_to = "Scale",
#                values_to = "Value")

small_to_big_long <- small_to_big %>%
  pivot_longer(cols = c("SSR", "SDSC", "CSHQ", "CRSP", "PSQ", "PSQI"),
               names_to = "Scale",
               values_to = "Value")
```


```{r}
n_symptoms <- n_distinct(small_to_big$broad.symptoms)
# long_data <- long_data %>% 
#   mutate(angle = 2 * pi * (Item_Number - 1) / n_symptoms)
small_to_big_long <- small_to_big_long %>%
  mutate(angle = 2 * pi * (Symptom - 1) / n_symptoms)
```

```{r}
# all_scales <- c("PANSS.10", "PANSS.30", "SAPS", "CRSS", "BPRS.18", "BPRS.24", "PSYRATS", "SANS", "CAINS", "BNSS", "MPS_SR", "NSA.16", "NSA.4")
all_scales_2 <- c("SSR", "SDSC", "CSHQ", "CRSP", "PSQ", "PSQI")

# long_data <- long_data %>% 
#   mutate(
#     Scale = factor(Scale, levels = all_scales),
#     Scale_id = as.numeric(Scale),    
#     Radius   = Scale_id + 3            
#   )

small_to_big_long <- small_to_big_long %>%
  mutate(
    Scale = factor(Scale, levels = all_scales_2),
    Scale_id = as.numeric(Scale),
    Radius   = Scale_id + 3
  )
```

```{r}
# long_data<- long_data %>% 
#   mutate(
#     x = Radius * cos(angle),
#     y = Radius * sin(angle)
#   )

small_to_big_long <- small_to_big_long %>%
  mutate(
    x = Radius * cos(angle),
    y = Radius * sin(angle)
  )
```

```{r}
circle_data <- expand.grid(
  radius = 4:max(small_to_big_long$Radius),                           # one circle per radius
  angle = seq(0, 2*pi, length.out = 200)           # 200 points around the circle
) %>%
  mutate(
    x = radius * cos(angle),
    y = radius * sin(angle)
  )
```

```{r}
spoke_data <- expand.grid(
  symptom_id = 1:41,
  radius = c(4, max(small_to_big_long$Radius))  # from 1 to outer ring
) %>%
  mutate(
    angle = 2*pi * (symptom_id - 1)/n_symptoms,
    x = radius * cos(angle),
    y = radius * sin(angle)
  )
```


```{r}
df_labels <- spoke_data %>%
  group_by(symptom_id) %>%
  slice_max(radius) %>%
  ungroup() %>%
  mutate(
    x_label = 1.1 * x,  
    y_label = 1.1 * y,
    label_text = paste0("S", symptom_id) 
  )
```

```{r}
symptoms <- tibble(
  symptom_name = small_to_big$broad.symptoms,
  x = 40,
  y = seq(from = 30, to = -30, length.out = 41)
)
```

```{r}
plot <- ggplot() +
  # 1) Concentric circles
  geom_path(
    data = circle_data,
    aes(x = x, y = y, group = radius),
    color = "gray70"    # or some light color
  ) +
  # 2) Radial spokes
  geom_path(
    data = spoke_data,
    aes(x = x, y = y, group = symptom_id),
    color = "gray70"
  ) +
  # 3) Your actual points
  geom_point(
    data = subset(small_to_big_long, Value == 1),
    aes(x = x, y = y, color = Scale),
    size = 2,
    alpha = 1
  ) +
  geom_text(
    data = df_labels,
    aes(x = x_label, y = y_label, label = label_text),
    size = 3
  ) +
  coord_equal() +
  theme_minimal() +
  ggtitle("Psychosis Scale Item Content Overlap Radial Diagram") +
  theme(
    legend.position = "left",
    plot.title = element_text(hjust = 0.5),
    plot.title.position = "plot",
    panel.grid  = element_blank(),
    axis.title  = element_blank(),
    axis.text   = element_blank(),
    axis.ticks  = element_blank()
  )
```

```{r}
radial_diagram <- ggplot() +
  # 1) Concentric circles
  geom_path(
    data = circle_data,
    aes(x = x, y = y, group = radius),
    color = "gray80",    # or some light color
    linewidth = 2
  ) +
  # 2) Radial spokes
  geom_path(
    data = spoke_data,
    aes(x = x, y = y, group = symptom_id),
    color = "gray70",
    linewidth = .1
  ) +
  # 3) Your actual points
  geom_point(
    data = subset(small_to_big_long, Value >= 1),
    aes(x = x, y = y, color = Scale),
    size = 4,
    alpha = 1
  ) +
  geom_text(
    data = df_labels,
    aes(x = x_label, y = y_label, label = label_text),
    size = 3
  ) +
  coord_equal() +
  theme_minimal() +
  ggtitle("Item Content Overlap of Pediatric Sleep Scales") +
  theme(
    legend.position = "left",
    plot.title = element_text(hjust = 0.5),
    plot.title.position = "plot",
    panel.grid  = element_blank(),
    axis.title  = element_blank(),
    axis.text   = element_blank(),
    axis.ticks  = element_blank()
  )

radial_diagram
ggsave("radial_diagram.png")
```

